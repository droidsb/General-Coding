
!function(e){function t(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=16)}([function(e,t,i){"use strict";function n(e){return a/r/e}function s(e,t){return(r*e-(r-o)*t)/(o*t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ditLength=n,t.wpm=function(e){return a/r/e},t.fditLength=function(e,t){return n(e)*s(e,t)},t.ratio=s,t.fwpm=function(e,t){return r*e/(o*t+(r-o))};var r=50,o=19,a=6e4},function(e,t,i){"use strict";function n(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i={morse:"",message:"",hasError:!1};if(""===(e=c(e)))return i;for(var n,r,o=[];e.length>0;)r=1,t&&(n=e.match(/^<...?>/))&&(r=n[0].length),o.push(e.slice(0,r)),e=e.slice(r,e.length);var a;a=t?l:s;var u,h,f;for(u=0;u<o.length;u++)void 0===(h=a[f=o[u]])?(i.message+="#"+f+"#",i.morse+="# ",i.hasError=!0):(i.message+=f,i.morse+=h+" ");return i.morse=i.morse.slice(0,i.morse.length-1),i}Object.defineProperty(t,"__esModule",{value:!0}),t.text2morse=n,t.text2ditdah=function(e,t){var i=n(e,t).morse+" ";return i=i.replace(/\./g,"di~").replace(/\-/g,"dah~"),i=i.replace(/~/g,"-"),i=i.replace(/\- /g," "),i=i.replace(/di /g,"dit "),i=i.replace(/ \/ /g,", "),i=i.replace(/^d/,"D"),i=i.replace(/ $/,""),i=i.replace(/([th])$/,"$1.")},t.morse2text=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i={morse:"",message:"",hasError:!1};if(""===(e=f(e)))return i;var n,s=e.split(" ");n=t?a:r;for(var o,l,u=0;u<s.length;u++)void 0===(o=n[l=s[u]])?(i.morse+="#"+l+"# ",i.message+="#",i.hasError=!0):(i.morse+=l+" ",i.message+=o);return i.morse=i.morse.slice(0,i.morse.length-1),i},t.looksLikeMorse=function(e){return!!(e=f(e)).match(/^[ /.-]*$/)},void 0===String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")});var s={A:".-",B:"-...",C:"-.-.",D:"-..",E:".",F:"..-.",G:"--.",H:"....",I:"..",J:".---",K:"-.-",L:".-..",M:"--",N:"-.",O:"---",P:".--.",Q:"--.-",R:".-.",S:"...",T:"-",U:"..-",V:"...-",W:".--",X:"-..-",Y:"-.--",Z:"--..",1:".----",2:"..---",3:"...--",4:"....-",5:".....",6:"-....",7:"--...",8:"---..",9:"----.",0:"-----",".":".-.-.-",",":"--..--",":":"---...","?":"..--..","'":".----.","-":"-....-","/":"-..-.","(":"-.--.-",")":"-.--.-",'"':".-..-.","@":".--.-.","=":"-...-"," ":"/"},r={},o={"<AA>":".-.-","<AR>":".-.-.","<AS>":".-...","<BK>":"-...-.-","<BT>":"-...-","<CL>":"-.-..-..","<CT>":"-.-.-","<DO>":"-..---","<KN>":"-.--.","<SK>":"...-.-","<VA>":"...-.-","<SN>":"...-.","<VE>":"...-.","<SOS>":"...---..."},a={},l={};for(var u in s)l[u]=s[u],r[s[u]]=u,a[s[u]]=u;for(var h in o)l[h]=o[h],a[o[h]]=h;var c=function(e){return e=e.toUpperCase(),e=e.trim(),e=e.replace(/\s+/g," ")},f=function(e){return e=e.replace(/\|/g,"/"),e=e.replace(/\//g," / "),e=e.replace(/\s+/g," "),e=e.replace(/(\/ )+\//g,"/"),e=e.replace(/_/g,"-"),e=e.replace(/^\s+/,""),e=e.replace(/\s+$/,"")}},,function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.displayChangelog=/*! 
This code is Â© Copyright Stephen C. Phillips, 2013-2015.
Email: steve@scphillips.com
*/
function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=Cookies.getJSON("changelog")||{},r=n||void 0!==s[e],o=s[e]||0;if(r&&o<t.length){for(var a=0;a<t.length-o;a++)i.find("ul").append("<li>"+t[a]+"</li>");i.foundation("reveal","open")}s[e]=t.length,Cookies.set("changelog",s,{expires:365})}},function(e,t,i){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,i):{};n.get||n.set?Object.defineProperty(t,i,n):t[i]=e[i]}return t.default=e,t}function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(i(1)),o=n(i(0)),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._wpm=void 0,this._fwpm=void 0,this._ditLen=void 0,this._fditLen=void 0,this.defaults={wpm:20,fwpm:20},this.wpm=t,this.fwpm=i,void 0!==n&&(this.messageCallback=n),void 0!==s&&(this.speedCallback=s),this.timings=[],this.characters=[],this.unusedTimes=[],this.noiseThreshold=1,this.morse="",this.message=""}return function(e,t,i){t&&s(e.prototype,t),i&&s(e,i)}(e,[{key:"updateThresholds",value:function(){this._ditDahThreshold=(1*this._ditLen+3*this._ditLen)/2,this._dahSpaceThreshold=(3*this._fditLen+7*this._fditLen)/2}},{key:"addTiming",value:function(e){if(0!==e){if(this.unusedTimes.length>0){var t=this.unusedTimes[this.unusedTimes.length-1];e*t>0?(this.unusedTimes.pop(),e=t+e):Math.abs(e)<=this.noiseThreshold&&(this.unusedTimes.pop(),e=t-e)}this.unusedTimes.push(e),-e>=this._ditDahThreshold&&this.flush()}}},{key:"flush",value:function(){if(" "===this.message[this.message.length-1]&&this.unusedTimes[0]<0&&this.unusedTimes.shift(),0!==this.unusedTimes.length){var e=this.unusedTimes[this.unusedTimes.length-1];e<0&&-e<this._dahSpaceThreshold&&this.unusedTimes.pop();var t=this.unusedTimes,i=this.timings2morse(this.unusedTimes),n=r.morse2text(i).message;this.morse+=i,this.message+=n,this.unusedTimes=e<0?[e]:[],this.messageCallback({timings:t,morse:i,message:n})}}},{key:"timings2morse",value:function(e){for(var t,i,n="",s=0;s<e.length;s++)t=(i=e[s])>0?i<this._ditDahThreshold?".":"-":(i=-i)<this._ditDahThreshold?"":i<this._dahSpaceThreshold?" ":"/",this.addDecode(i,t),n+=t;return n}},{key:"addDecode",value:function(e,t){this.timings.push(e),this.characters.push(t)}},{key:"getTimings",value:function(e){for(var t=[],i=0;i<this.timings.length;i++)this.characters[i]===e&&t.push(this.timings[i]);return t}},{key:"messageCallback",value:function(){}},{key:"speedCallback",value:function(){}},{key:"wpm",set:function(e){isNaN(e)&&(e=this.defaults.wpm),e=Math.max(e,1),this._wpm=e,(void 0===this._fwpm||this._fwpm>e)&&(this._fwpm=this._wpm),this._ditLen=o.ditLength(this._wpm),this._fditLen=o.fditLength(this._wpm,this._fwpm),this.updateThresholds(),this.speedCallback({wpm:this.wpm,fwpm:this.fwpm})},get:function(){return this._wpm}},{key:"fwpm",set:function(e){isNaN(e)&&(e=this.defaults.fwpm),e=Math.max(e,1),this._fwpm=e,(void 0===this._wpm||this._wpm<e)&&(this.wpm=e),this._ditLen=o.ditLength(this._wpm),this._fditLen=o.fditLength(this._wpm,this._fwpm),this.updateThresholds(),this.speedCallback({wpm:this.wpm,fwpm:this.fwpm})},get:function(){return this._fwpm}},{key:"ditLen",set:function(e){this._ditLen=e,(void 0===this._fditLen||this._fditLen<this._ditLen)&&(this._fditLen=this._ditLen),this._wpm=o.wpm(this._ditLen),this._fwpm=o.fwpm(this._wpm,this._fditLen/this._ditLen),this.updateThresholds()},get:function(){return this._ditLen}},{key:"fditLen",set:function(e){this._fditLen=e,(void 0===this._ditLen||this._ditLen>this._fditLen)&&(this._ditLen=this._fditLen),this._wpm=o.wpm(this._ditLen),this._fwpm=o.fwpm(this._wpm,this._fditLen/this._ditLen),this.updateThresholds()},get:function(){return this._fditLen}},{key:"dits",get:function(){return this.getTimings(".")}},{key:"dahs",get:function(){return this.getTimings("-")}},{key:"ditSpaces",get:function(){return this.getTimings("")}},{key:"dahSpaces",get:function(){return this.getTimings(" ")}},{key:"spaces",get:function(){return this.getTimings("/")}}]),e}();t.default=a},,,,,,,,,,,,function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var s=n(i(17)),r=n(i(18)),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,i):{};n.get||n.set?Object.defineProperty(t,i,n):t[i]=e[i]}return t.default=e,t}(i(3)),a=[],l=document.getElementById("micStart"),u=document.getElementById("micStop"),h=document.getElementById("fileInput"),c=document.getElementById("fileUpload"),f=document.getElementById("filePlay"),d=document.getElementById("fileStop"),m=document.getElementById("filename"),p=document.getElementById("output"),v=document.getElementById("clear"),g=document.getElementById("wpm"),y=document.getElementById("fwpm"),b=document.getElementById("wpmManual"),_=document.getElementById("freq"),k=document.getElementById("freqManual"),w=document.getElementById("volMin"),L=document.getElementById("volMax"),M=document.getElementById("volThresh"),S=document.getElementById("spectrogramGraph"),O=document.getElementById("morseGraph"),x=document.getElementById("zoomIn"),T=document.getElementById("zoomOut"),q=document.getElementById("freqMin"),B=document.getElementById("freqMax");l.addEventListener("click",function(){K.startListening()}),u.addEventListener("click",function(){K.stop(),E()}),v.addEventListener("click",function(){p.innerHTML="&nbsp;",message=""}),h.addEventListener("change",function(){var e=this.files;if(e.length>1)return console.log("Too many files selected ("+e.length+")"),void $("#manyFileErrorModal").foundation("reveal","open");var t=e[0];console.log("Filename: "+t.name),m.innerHTML="&quot;"+t.name+"&quot;";var i=new FileReader;i.onload=function(e){K.loadArrayBuffer(e.target.result)},i.readAsArrayBuffer(t)}),c.addEventListener("click",function(){h.click()}),f.addEventListener("click",function(){K.playArrayBuffer(),E()}),d.addEventListener("click",function(){K.stop(),E()}),_.addEventListener("change",function(){K.frequencyFilter=parseFloat(_.value)}),k.addEventListener("click",function(){_.disabled=!k.checked,K.lockFrequency=k.checked}),g.addEventListener("change",function(){W.wpm=parseFloat(g.value)}),y.addEventListener("change",function(){W.fwpm=parseFloat(y.value)}),b.addEventListener("click",function(){g.disabled=!b.checked,y.disabled=!b.checked,W.lockSpeed=b.checked}),w.addEventListener("change",function(){K.volumeFilterMin=parseFloat(w.value)}),L.addEventListener("change",function(){K.volumeFilterMax=parseFloat(L.value)}),M.addEventListener("change",function(){K.volumeThreshold=parseFloat(M.value)}),x.addEventListener("click",function(){x.disabled=!0,T.disabled=!1,V=!0,C()}),T.addEventListener("click",function(){x.disabled=!1,T.disabled=!0,V=!1,C()});var C=function(){q.innerHTML=K.freqStep,B.innerHTML=V?K.freqStep*G:K.maxFreq},E=function(){"mic"===K.input?(l.disabled=!0,u.disabled=!1,d.disabled=!0):"file"===K.input?(l.disabled=!1,u.disabled=!0,d.disabled=!1):(l.disabled=!1,u.disabled=!0,d.disabled=!0),f.disabled=void 0===K.fileAudioBuffer},F=function(e){g.value=Math.round(e.wpm),y.value=Math.round(e.fwpm)},N=function(e,t,i){D.globalAlpha=1,D.fillStyle="#ff0000",D.fillRect(A+1,0,1,z),D.fillStyle="#ffffff",D.fillRect(A,0,1,z);for(var n=V?G:e.length-1,s=z/n,r=1;r<n;r++)D.fillStyle=U(e[r]),D.fillRect(A,z-(r-1)*s,1,-s);D.globalAlpha=.2,D.fillStyle="#ff0000",D.fillRect(A,z-(t-1)*s,1,-(i-t+1)*s)},j=function(e){P.fillStyle="#ff0000",P.fillRect(A+1,0,1,R),P.fillStyle=e?"#000000":"#ffffff",P.fillRect(A,0,1,R)},D=S.getContext("2d"),P=O.getContext("2d"),I=0,A=0,z=254,R=20,H=970,U=chroma.scale("BuGn").domain([0,255]),V=!1,G=10,W=new s.default(20,20,30,function(e){var t="<span data-tooltip aria-haspopup='true' class='has-tip' title='"+e.morse+"'>"+e.message.replace("<","&lt;").replace(">","&gt;")+"</span>",i=p.innerHTML;"&nbsp;"!==i&&(t=i+t),p.innerHTML=t},F);W.speedCallbackRateLimiter=1;var K=new r.default(256,-60,-30,550,550,200,W,500,function(e){A=(++I-1)%H,N(e.frequencyData,e.filterBinLow,e.filterBinHigh),j(e.isOn)},function(e){_.value=Math.round((e.min+e.max)/2)},function(e){w.value=Math.round(e.min),L.value=Math.round(e.max)},function(e){M.value=e},E,function(e){console.log("Error accessing mic: "+e),$("#micErrorModal").foundation("reveal","open"),E()},function(e){console.log("AudioBuffer: sample rate "+e.sampleRate+" Hz, length "+e.length+" frames, duration "+e.duration+"s, channels "+e.numberOfChannels),E()},function(e){console.log("Error decoding file: "+e),$("#fileDecodeErrorModal").foundation("reveal","open"),E()},E);F({wpm:20,fwpm:20}),C(),E(),console.log("Sample rate: "+K.sampleRate),console.log("FFT Size: "+K.fftSize),console.log("Time step: "+K.timeStep),console.log("Frequency step: "+K.freqStep),console.log("Frequency bins: "+K.freqBins),$(document).ready(function(){o.displayChangelog("audio-decoder-adaptive",a,$("#changelogModal"))})},function(e,t,i){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var s=Object.getPrototypeOf(e);return null===s?void 0:r(s,t,i)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(i)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;!function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,i):{};n.get||n.set?Object.defineProperty(t,i,n):t[i]=e[i]}t.default=e}(i(0));var o=function(e){return e&&e.__esModule?e:{default:e}}(i(4)),a=function(e){function t(e,i){var s,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s=function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,o,a)),s.bufferSize=r,s.ditLengths=[],s.fditLengths=[],s.lockSpeed=!1,s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),function(e,t,i){t&&s(e.prototype,t),i&&s(e,i)}(t,[{key:"addDecode",value:function(e,i){r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addDecode",this).call(this,e,i);var n,s;switch(i){case".":n=e;break;case"-":n=e/3;break;case"":n=e;break;case" ":s=e/3}if(this.ditLengths.push(n),this.fditLengths.push(s),this.ditLengths=this.ditLengths.slice(-this.bufferSize),this.fditLengths=this.fditLengths.slice(-this.bufferSize),!this.lockSpeed){for(var o,a=0,l=0,u=0,h=0,c=0;c<this.bufferSize;c++)o=c+1,void 0!==this.ditLengths[c]&&(a+=this.ditLengths[c]*o,l+=o),void 0!==this.fditLengths[c]&&(u+=this.fditLengths[c]*o,h+=o);h&&(this.fditLen=u/h),l&&(this.ditLen=a/l),this.speedCallback({wpm:this.wpm,fwpm:this.fwpm})}}}]),t}();t.default=a},function(e,t,i){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var s=Object.getPrototypeOf(e);return null===s?void 0:r(s,t,i)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(i)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=function(e){return e&&e.__esModule?e:{default:e}}(i(19)),a=function(e){function t(e,i,s,r,o,a,l){var u,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:500,c=arguments.length>8?arguments[8]:void 0,f=arguments.length>9?arguments[9]:void 0,d=arguments.length>10?arguments[10]:void 0,m=arguments.length>11?arguments[11]:void 0,p=arguments.length>12?arguments[12]:void 0,v=arguments.length>13?arguments[13]:void 0,g=arguments.length>14?arguments[14]:void 0,y=arguments.length>15?arguments[15]:void 0,b=arguments.length>16?arguments[16]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(u=function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,s,r,o,a,l,c,f,d,m,p,v,g,y,b))).bufferSize=Math.floor(h/u.timeStep),u.bufferIndex=0,u.buffer=[];for(var _=0;_<u.bufferSize;_++)u.buffer[_]=new Uint8Array(u.freqBins);return u.averageVolume=new Uint32Array(u.freqBins),u.lockFrequency=!1,u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),function(e,t,i){t&&s(e.prototype,t),i&&s(e,i)}(t,[{key:"processSound",value:function(){r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"processSound",this).call(this);var e=this.frequencyData.reduce(function(e,t){return e+t});if(e-=this.frequencyData[0]){for(var i=0,n=0,s=1;s<this.freqBins;s++)this.averageVolume[s]=this.averageVolume[s]+this.frequencyData[s]-this.buffer[this.bufferIndex][s],this.buffer[this.bufferIndex][s]=this.frequencyData[s],this.averageVolume[s]>i&&(n=s,i=this.averageVolume[s]);this.bufferIndex=(this.bufferIndex+1)%this.bufferSize,this.lockFrequency||(this.frequencyFilter=n*this.freqStep)}}}]),t}();t.default=a},function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=function(){function e(t,i,n,s,r,o,a,l,u,h,c,f,d,m,p,v){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,this.audioContext=new window.AudioContext||new window.webkitAudioContext,void 0!==l&&(this.spectrogramCallback=l),void 0!==u&&(this.frequencyFilterCallback=u),void 0!==h&&(this.volumeFilterCallback=h),void 0!==c&&(this.volumeThresholdCallback=c),void 0!==f&&(this.micSuccessCallback=f),void 0!==d&&(this.micErrorCallback=d),void 0!==m&&(this.fileLoadCallback=m),void 0!==p&&(this.fileErrorCallback=p),void 0!==v&&(this.EOFCallback=v),this.fftSize=t,this.sampleRate=this.audioContext.sampleRate,this.maxFreq=this.sampleRate/2,this.freqBins=this.fftSize/2,this.timeStep=1e3/(this.sampleRate/this.fftSize),this.freqStep=this.maxFreq/this.freqBins,this.initialiseAudioNodes(),this.defaults={fftSize:256,volumeFilterMin:-60,volumeFilterMax:-30,frequencyFilterMin:550,frequencyFilterMax:550,volumeThreshold:200},this.volumeFilterMin=i,this.volumeFilterMax=n,this.frequencyFilterMin=s,this.frequencyFilterMax=r,this.volumeThreshold=o,this.decoder=a,this.notStarted=!0,this.flushTime=500,this.input=void 0}return function(e,t,i){t&&n(e.prototype,t),i&&n(e,i)}(e,[{key:"initialiseAudioNodes",value:function(){this.jsNode=this.audioContext.createScriptProcessor(this.fftSize,1,1),this.jsNode.onaudioprocess=this.processSound.bind(this),this.analyserNode=this.audioContext.createAnalyser(),this.analyserNode.smoothingTimeConstant=0,this.analyserNode.fftSize=this.fftSize,this.frequencyData=new Uint8Array(this.freqBins)}},{key:"startListening",value:function(){this.stop(),navigator.getUserMedia({audio:!0,video:!1},function(e){this.sourceNode=this.audioContext.createMediaStreamSource(e),this.input="mic",this.sourceNode.connect(this.analyserNode),this.jsNode.connect(this.audioContext.destination),this.micSuccessCallback()}.bind(this),function(e){this.input=void 0,this.micErrorCallback(e)}.bind(this))}},{key:"loadArrayBuffer",value:function(e){this.audioContext.decodeAudioData(e,function(e){this.fileAudioBuffer=e,this.fileLoadCallback(e)}.bind(this),function(e){this.fileAudioBuffer=void 0,this.fileErrorCallback(e)}.bind(this))}},{key:"playArrayBuffer",value:function(){this.stop(),this.sourceNode=this.audioContext.createBufferSource(),this.sourceNode.buffer=this.fileAudioBuffer,this.sourceNode.onended=function(){this.stop(),this.EOFCallback()}.bind(this),this.jsNode.connect(this.audioContext.destination),this.sourceNode.connect(this.analyserNode),this.sourceNode.connect(this.audioContext.destination),this.input="file",this.sourceNode.start()}},{key:"stop",value:function(){void 0!==this.input&&("file"===this.input&&(this.sourceNode.stop(),this.sourceNode.disconnect(this.audioContext.destination)),this.sourceNode.disconnect(this.analyserNode),this.jsNode.disconnect(this.audioContext.destination),this.flush(),this.decoder.flush(),this.input=void 0)}},{key:"processSound",value:function(){this.analyserNode.getByteFrequencyData(this.frequencyData);for(var e=0,t=this._filterBinLow;t<=this._filterBinHigh;t++)e+=this.frequencyData[t];var i=(e/=1*(this._filterBinHigh-this._filterBinLow+1))>=this._volumeThreshold;this.recordOnOrOff(i),this.spectrogramCallback({frequencyData:this.frequencyData,frequencyStep:this.freqStep,timeStep:this.timeStep,filterBinLow:this._filterBinLow,filterBinHigh:this._filterBinHigh,filterRegionVolume:e,isOn:i})}},{key:"recordOnOrOff",value:function(e){if(this.notStarted){if(!e)return;this.notStarted=!1,this.lastSoundWasOn=!0,this.ticks=0}this.lastSoundWasOn===e?(this.ticks++,this.ticks*this.timeStep>this.flushTime&&(this.flush(e),this.ticks=0)):(this.flush(!e),this.lastSoundWasOn=e,this.ticks=1)}},{key:"flush",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.lastSoundWasOn;this.decoder.addTiming((e?1:-1)*this.ticks*this.timeStep)}},{key:"spectrogramCallback",value:function(){}},{key:"frequencyFilterCallback",value:function(){}},{key:"volumeFilterCallback",value:function(){}},{key:"volumeThresholdCallback",value:function(){}},{key:"micSuccessCallback",value:function(){}},{key:"micErrorCallback",value:function(){}},{key:"fileLoadCallback",value:function(){}},{key:"fileErrorCallback",value:function(){}},{key:"EOFCallback",value:function(){}},{key:"volumeFilterMin",set:function(e){isNaN(e)&&(e=this.defaults.volumeFilterMin),e=Math.min(0,e),this.analyserNode.minDecibels=e,this.analyserNode.maxDecibels=Math.max(this.analyserNode.maxDecibels,e),this.volumeFilterCallback({min:this.analyserNode.minDecibels,max:this.analyserNode.maxDecibels})},get:function(){return this.analyserNode.minDecibels}},{key:"volumeFilterMax",set:function(e){isNaN(e)&&(e=this.defaults.volumeFilterMax),e=Math.min(0,e),this.analyserNode.maxDecibels=e,this.analyserNode.minDecibels=Math.min(this.analyserNode.minDecibels,e),this.volumeFilterCallback({min:this.analyserNode.minDecibels,max:this.analyserNode.maxDecibels})},get:function(){return this.analyserNode.maxDecibels}},{key:"frequencyFilterMin",set:function(e){isNaN(e)&&(e=this.defaults.frequencyFilterMin),e=Math.min(Math.max(e,0),this.maxFreq),this._filterBinLow=Math.min(Math.max(Math.round(e/this.freqStep),1),this.freqBins),this._filterBinHigh=Math.max(this._filterBinLow,this._filterBinHigh),this.frequencyFilterCallback({min:this.frequencyFilterMin,max:this.frequencyFilterMax})},get:function(){return Math.max(this._filterBinLow*this.freqStep,0)}},{key:"frequencyFilterMax",set:function(e){isNaN(e)&&(e=this.defaults.frequencyFilterMin),e=Math.min(Math.max(e,0),this.maxFreq),this._filterBinHigh=Math.min(Math.max(Math.round(e/this.freqStep),1),this.freqBins),this._filterBinLow=Math.min(this._filterBinHigh,this._filterBinLow),this.frequencyFilterCallback({min:this.frequencyFilterMin,max:this.frequencyFilterMax})},get:function(){return Math.min(this._filterBinHigh*this.freqStep,this.maxFreq)}},{key:"frequencyFilter",set:function(e){this.frequencyFilterMin=e,this.frequencyFilterMax=e}},{key:"volumeThreshold",set:function(e){isNaN(e)&&(e=this.defaults.volumeThreshold),this._volumeThreshold=Math.min(Math.max(Math.round(e),0),255),this.volumeThresholdCallback(this._volumeThreshold)},get:function(){return this._volumeThreshold}}]),e}();t.default=s}]);